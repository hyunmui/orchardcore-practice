@model Exhibition.AI.ViewModels.PageGeneratorViewModel
@using System.Text.Json

@{
    ViewData["Title"] = "AI 페이지 생성";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="max-w-4xl mx-auto p-6">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
            <i class="fas fa-magic text-blue-600"></i>
            AI 페이지 생성
        </h1>
        <p class="mt-2 text-gray-600">자연어로 원하는 페이지를 설명하면 AI가 자동으로 페이지 구조를 생성합니다.</p>
    </div>

    <div class="bg-white rounded-2xl shadow-md border border-gray-100 p-8 mb-8">
        <form asp-action="Generate" method="post">
            <div asp-validation-summary="ModelOnly" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 text-red-700"></div>

            <div class="mb-6">
                <label asp-for="Prompt" class="block text-sm font-semibold text-gray-700 mb-2">
                    페이지 설명 <span class="text-red-500">*</span>
                </label>
                <textarea asp-for="Prompt" rows="5"
                    class="w-full border border-gray-300 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors resize-none"
                    placeholder="예: 2024 스마트팩토리 전시회 메인 페이지를 만들어줘. 히어로 배너에는 '미래를 만드는 공장'이라는 제목을 넣고, 주요 참가업체 카드 섹션과 전시 일정표, 그리고 문의 폼을 추가해줘."></textarea>
                <span asp-validation-for="Prompt" class="text-red-500 text-sm mt-1 block"></span>
            </div>

            <div class="flex gap-3">
                <button type="submit"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-8 py-3 rounded-xl transition-colors duration-200 flex items-center gap-2">
                    <i class="fas fa-wand-magic-sparkles"></i>
                    페이지 생성
                </button>
                <button type="reset"
                    class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold px-8 py-3 rounded-xl transition-colors duration-200">
                    초기화
                </button>
            </div>
        </form>
    </div>

    @if (Model.HasResult)
    {
        @if (Model.IsSuccess && Model.GenerationResult != null)
        {
            <div class="bg-green-50 border border-green-200 rounded-2xl p-6 mb-6">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-check-circle text-green-600"></i>
                    <h2 class="text-lg font-bold text-green-800">생성 완료</h2>
                </div>
                <p class="text-green-700 text-sm">AI가 페이지 구조를 성공적으로 생성했습니다. 아래에서 결과를 확인하세요.</p>
            </div>

            <div class="bg-white rounded-2xl shadow-md border border-gray-100 p-8 mb-6">
                <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                    <i class="fas fa-file-alt text-blue-600"></i>
                    생성된 페이지 구조
                </h2>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">페이지 제목</p>
                        <p class="text-gray-900 font-bold text-lg">@Model.GenerationResult.Title</p>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <p class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1">URL 슬러그</p>
                        <p class="text-gray-900 font-mono">/@Model.GenerationResult.Permalink</p>
                    </div>
                </div>

                <h3 class="text-base font-bold text-gray-800 mb-4">위젯 목록 (@(Model.GenerationResult.Widgets.Count)개)</h3>
                <div class="space-y-3">
                    @for (int i = 0; i < Model.GenerationResult.Widgets.Count; i++)
                    {
                        var widget = Model.GenerationResult.Widgets[i];
                        <div class="flex items-start gap-4 p-4 bg-blue-50 border border-blue-100 rounded-xl">
                            <div class="bg-blue-600 text-white text-sm font-bold w-8 h-8 rounded-full flex items-center justify-center shrink-0">
                                @(i + 1)
                            </div>
                            <div class="flex-1">
                                <p class="font-bold text-blue-900">@widget.WidgetType</p>
                                <p class="text-blue-700 text-sm">@widget.Title</p>
                                <details class="mt-2">
                                    <summary class="text-xs text-blue-500 cursor-pointer hover:text-blue-700">속성 보기</summary>
                                    <pre class="mt-2 bg-white rounded-lg p-3 text-xs text-gray-600 overflow-x-auto">@JsonSerializer.Serialize(widget.Properties, new JsonSerializerOptions { WriteIndented = true })</pre>
                                </details>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="flex gap-3">
                <button type="button"
                    class="bg-green-600 hover:bg-green-700 text-white font-bold px-8 py-3 rounded-xl transition-colors duration-200 flex items-center gap-2">
                    <i class="fas fa-save"></i>
                    페이지로 저장
                </button>
                <a href="/Admin/Contents/ContentTypes/ExhibitionPage/Create"
                    class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-bold px-8 py-3 rounded-xl transition-colors duration-200 flex items-center gap-2">
                    <i class="fas fa-edit"></i>
                    수동으로 편집
                </a>
            </div>
        }
        else
        {
            <div class="bg-red-50 border border-red-200 rounded-2xl p-6">
                <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-exclamation-circle text-red-600"></i>
                    <h2 class="text-lg font-bold text-red-800">생성 실패</h2>
                </div>
                <p class="text-red-700">@(Model.GenerationResult?.ErrorMessage ?? "알 수 없는 오류가 발생했습니다.")</p>
            </div>
        }
    }
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
